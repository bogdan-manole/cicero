{{template "layout.html" .}}

{{define "main"}}
	<table
		class="table"
		style="width: 100%"
	>
		<thead>
			<tr>
				<th>Action</th>
				<th>Created At</th>
				<th>Finished At</th>
				<th>Duration</th>
				<th>Nomad Job ID</th>
			</tr>
		</thead>
		<tbody>
			{{range .Entries}}
				<tr>
					<td>
						{{with .Action}}
							<a href="/action/{{.ID}}">
								{{.Name}}
							</a>
						{{end}}
					</td>
					{{with .Run}}
						<td>{{.CreatedAt}}</td>
						<td>
							{{if .FinishedAt}}
								{{.FinishedAt}}
							{{else}}
								<form
									method="POST"
									action="/_dispatch/method/DELETE/run/{{.NomadJobID}}"
								>
									<button>Cancel</button>
								</form>
							{{end}}
						</td>
						<td class="numerical">
							{{if .FinishedAt}}
								{{.FinishedAt.Sub .CreatedAt}}
							{{else}}
								{{timeNow.Sub .CreatedAt}}
							{{end}}
						</td>
						<td>
							<a href="/run/{{.NomadJobID}}">
								{{.NomadJobID}}
							</a>
						</td>
					{{else}}
						{{with .Invocation}}
							<td>{{.CreatedAt}}</td>
							<td colspan="3">
								<a href="/invocation/{{.Id}}">Invocation</a>
								failed:
								{{$maxChars := 90}}
								{{$hasStderr := false}}
								{{with .EvalStderr}}
									{{with derefString .}}
										<samp class="log stderr">
											{{if gt (len .) $maxChars}}…{{end}}
											{{slice . (maxInt 0 (subInt (len .) $maxChars))}}
										</samp>
										{{$hasStderr = true}}
									{{end}}
								{{end}}
								{{if not $hasStderr}}
									{{with derefString .EvalStdout}}
										<samp class="log">
											{{if gt (len .) $maxChars}}…{{end}}
											{{slice . (maxInt 0 (subInt (len .) $maxChars))}}
										</samp>
									{{end}}
								{{end}}
							</td>
						{{end}}
					{{end}}
				</tr>
			{{end}}
		</tbody>
	</table>

	<nav style="display: flex; justify-content: end">
		{{template "pagination" .}}
	</nav>
{{end}}
